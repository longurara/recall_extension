<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recall - Settings</title>
  <link rel="stylesheet" href="settings.css">
</head>

<body>
  <div class="settings-page">
    <div class="settings-header">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <h1 id="heading-title">Recall Settings</h1>
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
          <label for="language" style="font-weight:600" data-i18n="language-label">Language</label>
          <select id="language" class="input-number" style="min-width:140px">
            <option value="en">English</option>
            <option value="vi">Tiếng Việt</option>
          </select>
          <span id="theme-toggle-container"></span>
        </div>
      </div>
      <p id="heading-desc">Configure how Recall captures and stores web page snapshots.</p>
    </div>

    <div class="settings-sections">
      <!-- Capture Settings -->
      <section class="section">
        <h2 data-i18n="capture-title">Capture</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label data-i18n="autoCapture-label">Auto-Capture</label>
            <p data-i18n="autoCapture-desc">Automatically capture pages when you visit them.</p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="autoCapture">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="setting-row">
          <div class="setting-info">
            <label for="captureDelay" data-i18n="captureDelay-label">Capture Delay</label>
            <p data-i18n="captureDelay-desc">Wait time (ms) after page loads before capturing. Higher values help with
              SPAs.</p>
          </div>
          <input type="number" id="captureDelay" class="input-number" min="500" max="30000" step="500">
        </div>

        <div class="setting-row">
          <div class="setting-info">
            <label for="duplicateWindowMinutes" data-i18n="duplicateWindow-label">Duplicate Window</label>
            <p data-i18n="duplicateWindow-desc">Skip capturing the same URL if already captured within this time
              (minutes).</p>
          </div>
          <input type="number" id="duplicateWindowMinutes" class="input-number" min="1" max="1440" step="1">
        </div>

        <div class="setting-row">
          <div class="setting-info">
            <label for="maxSnapshotSizeMB" data-i18n="maxSnapshotSize-label">Max Snapshot Size (MB)</label>
            <p data-i18n="maxSnapshotSize-desc">Skip pages larger than this size after serialization.</p>
          </div>
          <input type="number" id="maxSnapshotSizeMB" class="input-number" min="1" max="100" step="1">
        </div>
      </section>

      <!-- Storage Settings -->
      <section class="section">
        <h2 data-i18n="storage-title">Storage</h2>

        <div class="storage-status">
          <div class="storage-bar-lg">
            <div id="storage-fill" class="storage-fill" style="width: 0%"></div>
          </div>
          <div class="storage-stats">
            <span id="storage-used">0 B</span>
            <span id="storage-max">/ 2 GB</span>
            <span id="storage-count">(0 snapshots)</span>
          </div>
        </div>

        <div class="setting-row">
          <div class="setting-info">
            <label for="maxStorageMB" data-i18n="maxStorage-label">Storage Limit (MB)</label>
            <p data-i18n="maxStorage-desc">Maximum storage for all snapshots. Set 0 for unlimited (limited by disk
              space).</p>
          </div>
          <input type="number" id="maxStorageMB" class="input-number" min="0" max="102400" step="256">
        </div>

        <div class="setting-row">
          <div class="setting-info">
            <label data-i18n="autoCleanup-label">Auto-Cleanup</label>
            <p data-i18n="autoCleanup-desc">Automatically delete oldest non-starred snapshots when storage is nearly
              full.</p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="autoCleanupEnabled">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="setting-row">
          <div class="setting-info">
            <label for="autoCleanupThreshold" data-i18n="cleanupThreshold-label">Cleanup Threshold (%)</label>
            <p data-i18n="cleanupThreshold-desc">Start auto-cleanup when storage usage reaches this percentage.</p>
          </div>
          <input type="number" id="autoCleanupThreshold" class="input-number" min="50" max="99" step="1">
        </div>

        <div class="setting-row">
          <div class="setting-info">
            <label for="autoCleanupDays" data-i18n="autoCleanupDays-label">Delete Auto-Captures After (days)</label>
            <p data-i18n="autoCleanupDays-desc">Automatically delete auto-captured snapshots older than this many days.
              Manual and starred snapshots are never deleted. Set 0 to disable.</p>
          </div>
          <input type="number" id="autoCleanupDays" class="input-number" min="0" max="3650" step="1">
        </div>
      </section>

      <!-- Exclusions -->
      <section class="section">
        <h2 data-i18n="exclusions-title">Exclusions</h2>
        <div class="setting-row vertical">
          <div class="setting-info">
            <label for="excludeDomains" data-i18n="excludeDomains-label">Excluded Domains</label>
            <p data-i18n="excludeDomains-desc">Pages from these domains will not be auto-captured. One domain per line.
            </p>
          </div>
          <textarea id="excludeDomains" class="input-textarea" rows="6"
            placeholder="example.com&#10;private.internal.com"></textarea>
        </div>
      </section>

      <!-- Thumbnail Settings -->
      <section class="section">
        <h2 data-i18n="thumbnails-title">Thumbnails</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label for="thumbnailQuality" data-i18n="thumbnailQuality-label">JPEG Quality</label>
            <p data-i18n="thumbnailQuality-desc">Thumbnail image quality (0.1 - 1.0). Lower = smaller files.</p>
          </div>
          <input type="number" id="thumbnailQuality" class="input-number" min="0.1" max="1" step="0.1">
        </div>
        <div class="setting-row">
          <div class="setting-info">
            <label data-i18n="saveOriginal-label">Giữ ảnh gốc</label>
            <p data-i18n="saveOriginal-desc">Lưu ảnh chụp màn hình gốc (full-res) để xuất backup. Tốn thêm dung lượng.
            </p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="saveOriginalScreenshots">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </section>

      <!-- Data Management -->
      <section class="section">
        <h2 data-i18n="data-title">Data Management</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label data-i18n="exportBackup-label">Xuất Backup (ZIP)</label>
            <p data-i18n="exportBackup-desc">Gộp toàn bộ snapshot + metadata + ảnh gốc vào một file ZIP.</p>
          </div>
          <button id="btn-export-backup" class="btn btn-primary" data-i18n="btn-export-backup">Xuất Backup</button>
        </div>
        <div class="setting-row">
          <div class="setting-info">
            <label data-i18n="exportMeta-label">Export Metadata</label>
            <p data-i18n="exportMeta-desc">Chỉ xuất metadata dưới dạng JSON (nhẹ, không kèm dữ liệu nội dung).</p>
          </div>
          <button id="btn-export-data" class="btn btn-secondary" data-i18n="btn-export-data">Export Metadata</button>
        </div>
        <div class="setting-row">
          <div class="setting-info">
            <label data-i18n="importBackup-label">Import Backup (ZIP)</label>
            <p data-i18n="importBackup-desc">Khôi phục toàn bộ dữ liệu từ file ZIP đã xuất. Sẽ thay thế dữ liệu hiện có.
            </p>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <input id="input-import-backup" type="file" accept="application/zip,.zip" style="display:none">
            <button id="btn-import-backup" class="btn btn-primary" data-i18n="btn-import-backup">Import Backup</button>
          </div>
        </div>
        <div class="setting-row">
          <div class="setting-info">
            <label data-i18n="deleteAll-label">Delete All Snapshots</label>
            <p data-i18n="deleteAll-desc">Permanently delete all captured snapshots. This cannot be undone.</p>
          </div>
          <button id="btn-delete-all" class="btn btn-danger" data-i18n="btn-delete-all">Delete All</button>
        </div>
      </section>

      <!-- Auto-Tag Rules -->
      <section class="section">
        <h2>Auto-Tag Rules</h2>
        <p class="section-desc">Automatically tag snapshots based on the domain they were captured from.</p>
        <div id="auto-tag-rules" class="auto-tag-rules">
          <!-- Dynamic rules go here -->
        </div>
        <div class="setting-row">
          <input type="text" id="new-rule-domain" class="input-text" placeholder="e.g. github.com" style="flex:1">
          <input type="text" id="new-rule-tag" class="input-text" placeholder="e.g. dev" style="flex:1">
          <button id="btn-add-rule" class="btn btn-secondary">Add Rule</button>
        </div>
      </section>

      <!-- AI Summary -->
      <section class="section">
        <h2>AI Summary</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label for="aiProvider">AI Provider</label>
            <p>Choose how AI summaries are generated for captured pages.</p>
          </div>
          <select id="aiProvider" class="input-select">
            <option value="none">None (disabled)</option>
            <option value="basic">Basic (offline, extractive)</option>
            <option value="google">Google Gemini</option>
            <option value="openai">OpenAI API</option>
            <option value="custom">Custom Endpoint</option>
          </select>
        </div>
        <div id="ai-api-settings" class="ai-api-settings hidden">
          <div class="setting-row">
            <div class="setting-info">
              <label for="aiApiKey">API Key</label>
            </div>
            <div class="api-key-row">
              <input type="password" id="aiApiKey" class="input-text" placeholder="sk-...">
              <button id="btn-clear-ai-key" class="btn btn-secondary-sm" type="button">Clear</button>
            </div>
          </div>
          <div id="ai-model-row" class="setting-row hidden">
            <div class="setting-info">
              <label for="aiModel">Model</label>
              <p>Select an AI model. Click "Fetch" to load available models from your API key.</p>
            </div>
            <div class="model-selector-row">
              <select id="aiModel" class="input-select">
                <option value="">— Select model —</option>
              </select>
              <button id="btn-fetch-models" class="btn btn-secondary-sm">Fetch</button>
            </div>
          </div>
          <div id="ai-endpoint-row" class="setting-row hidden">
            <div class="setting-info">
              <label for="aiApiEndpoint">Custom Endpoint</label>
            </div>
            <input type="text" id="aiApiEndpoint" class="input-text"
              placeholder="https://api.example.com/v1/chat/completions">
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <label for="aiRequireConfirm">Confirm before sending content</label>
              <p>Show a confirmation dialog before sending snapshot text to external AI providers.</p>
            </div>
            <label class="toggle">
              <input type="checkbox" id="aiRequireConfirm">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <label for="aiBlockedDomains">AI blocklist</label>
              <p>Snapshots from these domains will never be sent to AI. One item per line; supports prefixes like 127. or .bank.</p>
            </div>
            <textarea id="aiBlockedDomains" class="input-text" rows="4" placeholder="localhost
127.
.bank"></textarea>
          </div>
        </div>
      </section>

      <!-- Smart Notifications -->
      <section class="section">
        <h2>Smart Notifications</h2>
        <div class="setting-row">
          <div class="setting-info">
            <label for="readLaterReminderDays">Read Later Reminder (days)</label>
            <p>Remind you about unread pages older than this many days. Set 0 to disable.</p>
          </div>
          <input type="number" id="readLaterReminderDays" class="input-number" min="0" max="365" step="1">
        </div>
        <div class="setting-row">
          <div class="setting-info">
            <label>Storage Warning</label>
            <p>Get notified when storage usage exceeds the warning threshold.</p>
          </div>
          <label class="toggle">
            <input type="checkbox" id="storageWarningEnabled">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </section>

      <!-- About -->
      <section class="section">
        <h2 data-i18n="about-title">About</h2>
        <div class="about-info">
          <p><strong data-i18n="about-name">Recall - Web Page Snapshots</strong></p>
          <p data-i18n="about-version">Version 1.0.0</p>
          <p data-i18n="about-desc">Automatically save and recall web pages. View snapshots anytime, even offline.</p>
          <p class="shortcuts-info">
            <strong data-i18n="about-shortcuts">Keyboard Shortcuts:</strong><br>
            <code>Ctrl+Shift+S</code> - <span data-i18n="shortcut-capture">Capture current page</span><br>
            <code>Ctrl+Shift+R</code> - <span data-i18n="shortcut-manager">Open Manager</span>
          </p>
        </div>
      </section>
    </div>

    <!-- Save Bar -->
    <div id="save-bar" class="save-bar hidden">
      <span data-i18n="unsaved">You have unsaved changes</span>
      <div class="save-actions">
        <button id="btn-discard" class="btn btn-ghost-sm" data-i18n="btn-discard">Discard</button>
        <button id="btn-save" class="btn btn-primary-sm" data-i18n="btn-save">Save Settings</button>
      </div>
    </div>
  </div>

  <script src="settings.js" type="module"></script>
</body>

</html>
